import{r as v,j as e}from"./ui-BW6CElO3.js";import{u as N}from"./useQuery-PQU2-nrG.js";import{d as L,u as T,e as D,f as F,g as P,B as a,P as w,p as x,C,a as $,h as V,b as M,M as A}from"./index-CruXR4SJ.js";import{f as p,a as I}from"./categories-DUi1-GTl.js";import{B as k}from"./badge-B6EIsa0n.js";import{M as R}from"./mission-detail-modal-BQT_hprF.js";import{C as H}from"./circle-alert-D9eOHE6H.js";import{E as K}from"./eye-mHwwNfAt.js";import{S as Q}from"./square-pen-CE5nSoK2.js";import{T as W}from"./trash-2-CxFkJ13R.js";import{C as O,H as G}from"./hand-CMoIVVtC.js";import"./vendor-D3F3s8fL.js";import"./textarea-BpAJBEFf.js";import"./tabs-B9dTGTml.js";import"./availability-calendar-aGhLss_h.js";import"./calendar-CLUFdX_L.js";import"./chevron-left-euKzbHZl.js";import"./clock-DhwM5UP0.js";import"./save-BJA4osVy.js";import"./map-pin-CFL41LCE.js";import"./calendar-CWrjCpnt.js";import"./message-circle-sTfbYlPh.js";import"./phone-Cutl7suT.js";import"./award-BuSSH-k5.js";import"./star-C4SHTlAV.js";import"./circle-check-big-DWyujOxb.js";import"./circle-x-DJe2a9tX.js";import"./smart-bid-analyzer-D8hmBViS.js";import"./triangle-alert-CYGB0azP.js";import"./lightbulb-zplnNXzl.js";import"./trending-up-CYsDO2ma.js";import"./euro-CIOn5Ay8.js";import"./user-check-a682oyVx.js";function Ee(){const{user:r}=L(),[,i]=T(),[n,h]=v.useState("posted"),[u,b]=v.useState(null),E=D(),{toast:f}=F(),{data:c=[],isLoading:j,error:B}=N({queryKey:["userMissions",r?.id],queryFn:async()=>{const s=await fetch(`/api/missions/users/${r?.id}/missions`);if(!s.ok)throw new Error("Failed to fetch user missions");const t=await s.json();return await Promise.all(t.map(async l=>{try{const o=await fetch(`/api/missions/${l.id}`);if(o.ok){const z=await o.json();return{...l,bids:z.bids||[]}}return{...l,bids:[]}}catch(o){return console.error(`Erreur récupération offres mission ${l.id}:`,o),{...l,bids:[]}}}))},enabled:!!r}),{data:m=[],isLoading:g}=N({queryKey:["userBids",r?.id],queryFn:async()=>{const s=await fetch(`/api/missions/users/${r?.id}/bids`);if(!s.ok)throw new Error("Failed to fetch user bids");return s.json()},enabled:!!r&&r.type==="provider"}),y=P({mutationFn:async s=>{const t=await fetch(`/api/missions/${s}`,{method:"DELETE"});if(!t.ok)throw new Error("Failed to delete mission");return t.json()},onSuccess:()=>{E.invalidateQueries({queryKey:["userMissions"]}),f({title:"Mission supprimée",description:"Votre mission a été supprimée avec succès."})},onError:s=>{f({title:"Erreur",description:"Impossible de supprimer la mission.",variant:"destructive"})}}),S=s=>{window.confirm("Êtes-vous sûr de vouloir supprimer cette mission ?")&&y.mutate(s)},q=s=>{const t={published:{label:"Publiée",variant:"default"},open:{label:"Ouverte",variant:"default"},in_progress:{label:"En cours",variant:"secondary"},completed:{label:"Terminée",variant:"outline"},closed:{label:"Fermée",variant:"destructive"}},d=t[s]||t.published;return e.jsx(k,{variant:d.variant,children:d.label})};return r?e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6 sm:mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-1 sm:mb-2",children:"Mes Missions"}),e.jsx("p",{className:"text-base sm:text-lg text-gray-600",children:"Gérez vos projets et consultez les offres reçues"})]}),e.jsxs(a,{onClick:()=>i(x.createMission),size:"lg",className:"w-full sm:w-auto",children:[e.jsx(w,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5"}),"Nouveau Projet"]})]}),e.jsx("div",{className:"border-b border-gray-200 mb-8",children:e.jsxs("nav",{className:"-mb-px flex space-x-6 sm:space-x-8",children:[e.jsxs("button",{onClick:()=>h("posted"),className:`py-2 px-1 border-b-2 font-medium text-sm sm:text-base ${n==="posted"?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["Missions publiées (",c.length,")"]}),r.type==="provider"&&e.jsxs("button",{onClick:()=>h("bids"),className:`py-2 px-1 border-b-2 font-medium text-sm sm:text-base ${n==="bids"?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["Mes candidatures (",m.length,")"]})]})}),(j||g)&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Chargement..."})]}),B&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"w-16 h-16 text-red-300 mx-auto mb-4"}),e.jsx("p",{className:"text-red-500 text-lg mb-4",children:"Erreur de chargement"}),e.jsx(a,{onClick:()=>window.location.reload(),variant:"outline",children:"Réessayer"})]}),n==="posted"&&!j&&e.jsx("div",{className:"space-y-6",children:c.length>0?c.map(s=>e.jsxs(C,{className:"hover:shadow-lg transition-shadow",children:[e.jsx($,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(V,{className:"text-xl",children:s.title}),q(s.status||"published")]}),e.jsx("p",{className:"text-gray-600 text-sm sm:text-base",children:s.description})]}),e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsx("div",{className:"text-xl font-bold text-primary",children:p(s.budget||"0")}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:I(s.createdAt)})]})]})}),e.jsxs(M,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-gray-600",children:[e.jsxs("span",{children:["Catégorie: ",s.category]}),e.jsxs("span",{children:["Lieu: ",s.location||"Non spécifié"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.bids?.length||0," offre",(s.bids?.length||0)!==1?"s":""]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>b(s.id?.toString()||null),className:"flex items-center gap-1",children:[e.jsx(K,{className:"w-4 h-4"}),"Voir les offres"]}),e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>i(x.editMission(s.id?.toString()||"")),className:"flex items-center gap-1",children:[e.jsx(Q,{className:"w-4 h-4"}),"Modifier"]}),e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>S(s.id),className:"flex items-center gap-1 text-red-600 hover:text-red-700",disabled:y.isPending,children:[e.jsx(W,{className:"w-4 h-4"}),"Supprimer"]})]})]}),s.bids&&s.bids.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Dernières offres reçues :"}),e.jsxs("div",{className:"space-y-2",children:[s.bids.slice(0,2).map(t=>e.jsxs("div",{className:"flex justify-between items-center text-sm bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"truncate flex-1",children:t.proposal}),e.jsx("span",{className:"font-medium text-primary ml-2",children:p(t.price)})]},t.id)),s.bids.length>2&&e.jsxs("p",{className:"text-xs text-gray-500",children:["+",s.bids.length-2," autre",s.bids.length-2>1?"s":""," offre",s.bids.length-2>1?"s":""]})]})]})]})]},s.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(O,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Vous n'avez pas encore publié de missions"}),e.jsxs(a,{onClick:()=>i(x.createMission),className:"bg-primary hover:bg-primary-dark text-white",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Créer ma première mission"]})]})}),n==="bids"&&r.type==="provider"&&!g&&e.jsx("div",{className:"space-y-6",children:m.length>0?m.map(s=>e.jsx(C,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Candidature soumise"}),e.jsx("p",{className:"text-gray-600 mb-4 text-sm sm:text-base",children:s.proposal}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Votre offre:"}),e.jsx("span",{className:"text-xl font-bold text-primary ml-2",children:p(s.price)})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Délai: ",s.timeline]}),e.jsx(k,{variant:"secondary",children:"En attente"})]})]})]})},s.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(G,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Vous n'avez pas encore postulé à des missions"}),e.jsx(a,{onClick:()=>i("/marketplace"),className:"bg-primary hover:bg-primary-dark text-white",children:"Découvrir les missions"})]})}),e.jsx(R,{missionId:u,isOpen:!!u,onClose:()=>b(null)})]}):e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Connexion requise"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Veuillez vous connecter pour voir vos missions"}),e.jsx(a,{onClick:()=>i("/"),children:"Retour à l'accueil"})]})})}export{Ee as default};
