import{r as b,j as e}from"./ui-BW6CElO3.js";import{u as E}from"./useQuery-TCraoA3K.js";import{d as L,u as M,f as T,e as q,g as D,B as d,A as k,C as P,a as V,h as A,b as Q,L as n,I as h}from"./index-C4tHrSDC.js";import{T as R}from"./textarea-DCVv39qR.js";import{S as j,a as p,b as g,c as v,d as r}from"./select-B7N0n6Fd.js";import{c as B}from"./categories-Ci5EyH-Y.js";import{L as C}from"./loader-circle-DJ3A_IRH.js";import{S as K}from"./save-B1ThN8AT.js";import"./vendor-D3F3s8fL.js";import"./index-DDShL7U6.js";import"./chevron-up-zp9oWfM5.js";function Y({missionId:l}){const{user:N}=L(),[,o]=M(),{toast:u}=T(),f=q(),[i,y]=b.useState({title:"",description:"",category:"",budget:"",location:"",urgency:"medium",status:"published"}),{data:t,isLoading:w,error:F}=E({queryKey:["mission",l],queryFn:async()=>{const s=await fetch(`/api/missions/${l}`);if(!s.ok)throw new Error("Failed to fetch mission");return s.json()},enabled:!!l}),m=D({mutationFn:async s=>{const c=await fetch(`/api/missions/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!c.ok){const x=await c.json();throw new Error(x.error||"Failed to update mission")}return c.json()},onSuccess:()=>{f.invalidateQueries({queryKey:["userMissions"]}),f.invalidateQueries({queryKey:["mission",l]}),u({title:"Mission modifiée",description:"Votre mission a été mise à jour avec succès."}),o("/missions")},onError:s=>{u({title:"Erreur",description:s.message||"Impossible de modifier la mission.",variant:"destructive"})}});b.useEffect(()=>{t&&y({title:t.title||"",description:t.description||"",category:t.category||"",budget:t.budget?.toString()||"",location:t.location||"",urgency:t.urgency||"medium",status:t.status||"published"})},[t]);const S=s=>{if(s.preventDefault(),!i.title.trim()||!i.description.trim()){u({title:"Erreur",description:"Le titre et la description sont obligatoires.",variant:"destructive"});return}m.mutate(i)},a=(s,c)=>{y(x=>({...x,[s]:c}))};return N?w?e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"w-8 h-8 animate-spin mx-auto mb-4"}),e.jsx("p",{children:"Chargement de la mission..."})]})}):F||!t?e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Mission introuvable"}),e.jsx(d,{onClick:()=>o("/missions"),children:"Retour aux missions"})]})}):e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(d,{variant:"outline",onClick:()=>o("/missions"),className:"mb-4",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Retour aux missions"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Modifier la mission"})]}),e.jsxs(P,{children:[e.jsx(V,{children:e.jsx(A,{children:"Informations de la mission"})}),e.jsx(Q,{children:e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"title",children:"Titre de la mission *"}),e.jsx(h,{id:"title",value:i.title,onChange:s=>a("title",s.target.value),placeholder:"Ex: Développement d'une application mobile",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"description",children:"Description *"}),e.jsx(R,{id:"description",value:i.description,onChange:s=>a("description",s.target.value),placeholder:"Décrivez votre projet en détail...",rows:4,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"category",children:"Catégorie"}),e.jsxs(j,{value:i.category,onValueChange:s=>a("category",s),children:[e.jsx(p,{children:e.jsx(g,{placeholder:"Choisir une catégorie"})}),e.jsx(v,{children:B.map(s=>e.jsx(r,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"budget",children:"Budget (€)"}),e.jsx(h,{id:"budget",type:"number",value:i.budget,onChange:s=>a("budget",s.target.value),placeholder:"1000"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"location",children:"Localisation"}),e.jsx(h,{id:"location",value:i.location,onChange:s=>a("location",s.target.value),placeholder:"Paris, France"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"urgency",children:"Urgence"}),e.jsxs(j,{value:i.urgency,onValueChange:s=>a("urgency",s),children:[e.jsx(p,{children:e.jsx(g,{})}),e.jsxs(v,{children:[e.jsx(r,{value:"low",children:"Faible"}),e.jsx(r,{value:"medium",children:"Moyenne"}),e.jsx(r,{value:"high",children:"Élevée"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"status",children:"Statut"}),e.jsxs(j,{value:i.status,onValueChange:s=>a("status",s),children:[e.jsx(p,{children:e.jsx(g,{})}),e.jsxs(v,{children:[e.jsx(r,{value:"published",children:"Publiée"}),e.jsx(r,{value:"open",children:"Ouverte"}),e.jsx(r,{value:"in_progress",children:"En cours"}),e.jsx(r,{value:"completed",children:"Terminée"}),e.jsx(r,{value:"closed",children:"Fermée"})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(d,{type:"submit",disabled:m.isPending,className:"flex-1",children:m.isPending?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Enregistrer les modifications"]})}),e.jsx(d,{type:"button",variant:"outline",onClick:()=>o("/missions"),children:"Annuler"})]})]})})]})]}):e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Connexion requise"}),e.jsx(d,{onClick:()=>o("/"),children:"Retour à l'accueil"})]})})}export{Y as default};
