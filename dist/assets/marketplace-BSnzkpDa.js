import{j as e,r as M}from"./ui-he1BrmUV.js";import{u as re}from"./useQuery-COcRbRzO.js";import{C as F,b as Q,c as W,U as G,d as ne,e as le,f as ce,Z as oe,P as ie,T as de,B as $,g as me,u as ue,L as V,I as he}from"./index-CBBDTguF.js";import{d as xe}from"./services-B9yTTPPJ.js";import{B}from"./badge-BczrwgLg.js";import{c as J}from"./categories-CJOmrs8V.js";import{E as ge}from"./euro-CLLzLmeN.js";import{M as fe}from"./map-pin-BJaPs52M.js";import{T as ee}from"./trending-up-DkuIDdIi.js";import{C as pe}from"./clock-DlmMV53Q.js";import{t as y,c as be,e as je,d as ye,g as Y,a as Ne,b as ve,m as Z,f as E}from"./en-US-oEpl4HuW.js";import{f as we}from"./fr-Qfl_UVRO.js";import{R as Me}from"./refresh-cw-Cnug58tM.js";import{T as Ce,C as Se}from"./triangle-alert-DaV9Jhgz.js";import{S as X,a as U,b as O,c as K,d as w}from"./select-D-LW2z9h.js";import{B as De}from"./brain-Cs_dEmzr.js";import{S as Le}from"./star-CvxPlCQO.js";import"./vendor-D3F3s8fL.js";import"./index-BelvN6Su.js";import"./chevron-up-DQznW12x.js";function _(a,i){const m=y(a),u=y(i),o=m.getTime()-u.getTime();return o<0?-1:o>0?1:o}function Re(a){return be(a,Date.now())}function Te(a){return i=>{const u=(a?Math[a]:Math.trunc)(i);return u===0?0:u}}function ke(a,i){return+y(a)-+y(i)}function Pe(a){const i=y(a);return i.setHours(23,59,59,999),i}function Ae(a){const i=y(a);return+Pe(i)==+je(i)}function Ie(a,i){const m=y(a),u=y(i),o=_(m,u),j=Math.abs(ye(m,u));let b;if(j<1)b=0;else{m.getMonth()===1&&m.getDate()>27&&m.setDate(30),m.setMonth(m.getMonth()-o*j);let d=_(m,u)===-o;Ae(y(a))&&j===1&&_(a,u)===1&&(d=!1),b=o*(j-Number(d))}return b===0?0:b}function Be(a,i,m){const u=ke(a,i)/1e3;return Te(m?.roundingMethod)(u)}function ze(a,i,m){const u=Ne(),o=m?.locale??u.locale??ve,j=2520,b=_(a,i);if(isNaN(b))throw new RangeError("Invalid time value");const d=Object.assign({},m,{addSuffix:m?.addSuffix,comparison:b});let N,S;b>0?(N=y(i),S=y(a)):(N=y(a),S=y(i));const h=Be(S,N),k=(Y(S)-Y(N))/1e3,p=Math.round((h-k)/60);let x;if(p<2)return m?.includeSeconds?h<5?o.formatDistance("lessThanXSeconds",5,d):h<10?o.formatDistance("lessThanXSeconds",10,d):h<20?o.formatDistance("lessThanXSeconds",20,d):h<40?o.formatDistance("halfAMinute",0,d):h<60?o.formatDistance("lessThanXMinutes",1,d):o.formatDistance("xMinutes",1,d):p===0?o.formatDistance("lessThanXMinutes",1,d):o.formatDistance("xMinutes",p,d);if(p<45)return o.formatDistance("xMinutes",p,d);if(p<90)return o.formatDistance("aboutXHours",1,d);if(p<Z){const g=Math.round(p/60);return o.formatDistance("aboutXHours",g,d)}else{if(p<j)return o.formatDistance("xDays",1,d);if(p<E){const g=Math.round(p/Z);return o.formatDistance("xDays",g,d)}else if(p<E*2)return x=Math.round(p/E),o.formatDistance("aboutXMonths",x,d)}if(x=Ie(S,N),x<12){const g=Math.round(p/E);return o.formatDistance("xMonths",g,d)}else{const g=x%12,C=Math.trunc(x/12);return g<3?o.formatDistance("aboutXYears",C,d):g<9?o.formatDistance("overXYears",C,d):o.formatDistance("almostXYears",C+1,d)}}function Ee(a,i){return ze(a,Re(a),i)}function Fe({mission:a,onClick:i}){const m=J.find(o=>o.id===a.category),u=a.bids.length>0?a.bids.reduce((o,j)=>o+j.amount,0)/a.bids.length:0;return e.jsxs(F,{className:"hover:shadow-lg transition-all duration-300 cursor-pointer border-l-4 border-l-blue-500 hover:scale-[1.02] bg-white h-fit",onClick:i,children:[e.jsx(Q,{className:"pb-2 pt-3",children:e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsx("h3",{className:"font-semibold text-base line-clamp-2 flex-1 leading-tight",children:a.title}),e.jsxs("div",{className:"flex flex-col gap-1 items-end",children:[e.jsx(B,{variant:"secondary",className:"shrink-0 text-xs px-2 py-1",children:m?.name||a.category}),a.bids.length>0&&e.jsxs(B,{variant:"outline",className:"text-xs px-2 py-1",children:["🔥 ",a.bids.length]})]})]})}),e.jsxs(W,{className:"py-1",children:[e.jsx("p",{className:"text-gray-600 line-clamp-2 mb-3 text-sm leading-relaxed",children:a.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(ge,{className:"w-3 h-3 text-green-600"}),e.jsx("span",{className:"font-medium truncate",children:a.budgetDisplay})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(G,{className:"w-3 h-3 text-purple-600"}),e.jsxs("span",{className:"truncate",children:[a.bids.length," offre",a.bids.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(fe,{className:"w-3 h-3 text-blue-600"}),e.jsx("span",{className:"truncate",children:a.location||"Non spécifié"})]}),u>0&&e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(ee,{className:"w-3 h-3 text-orange-600"}),e.jsxs("span",{className:"font-medium truncate",children:[Math.round(u),"€ moy"]})]})]})]}),e.jsx(ne,{className:"pt-2 pb-3 border-t bg-gray-50/50",children:e.jsxs("div",{className:"flex justify-between items-center w-full text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:Ee(new Date(a.createdAt),{addSuffix:!0,locale:we})})]}),e.jsx("div",{className:"text-xs font-medium text-primary truncate ml-2",children:a.clientName})]})})]})}function $e({isLoading:a=!1,hasError:i=!1,isFallbackMode:m=!1,errorMessage:u,onRetry:o,className:j=""}){if(!a&&!i&&!m)return null;const d=a?{icon:Me,color:"blue",title:"Chargement en cours...",message:"Récupération des données",bgClass:"bg-blue-50 border-blue-200",textClass:"text-blue-800",iconClass:"text-blue-500 animate-spin"}:m?{icon:Ce,color:"orange",title:"Mode dégradé",message:"Le service fonctionne avec des fonctionnalités limitées",bgClass:"bg-orange-50 border-orange-200",textClass:"text-orange-800",iconClass:"text-orange-500"}:i?{icon:Se,color:"red",title:"Problème technique",message:u||"Une erreur est survenue",bgClass:"bg-red-50 border-red-200",textClass:"text-red-800",iconClass:"text-red-500"}:{icon:le,color:"green",title:"Service opérationnel",message:"Tout fonctionne normalement",bgClass:"bg-green-50 border-green-200",textClass:"text-green-800",iconClass:"text-green-500"},N=d.icon;return e.jsx("div",{className:`border rounded-lg p-4 ${d.bgClass} ${j}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:`w-5 h-5 ${d.iconClass}`}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-medium ${d.textClass}`,children:d.title}),e.jsx("p",{className:`text-sm ${d.textClass} opacity-80`,children:d.message})]})]}),o&&(i||m)&&e.jsx("button",{onClick:o,className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${d.color==="orange"?"bg-orange-200 hover:bg-orange-300 text-orange-800":"bg-red-200 hover:bg-red-300 text-red-800"}`,children:"Réessayer"})]})})}function _e({providerProfile:a,missions:i,onMissionRecommended:m}){const[u,o]=M.useState([]),[j,b]=M.useState(!1),[d,N]=M.useState({minMatchScore:70,maxCompetition:"high",minWinProbability:40}),S=async()=>{b(!0),await new Promise(s=>setTimeout(s,1500));const c=i.map(s=>{const r=h(s,a),l=k(s,a),I=p(s,a),T=x(s,a),q=r*.35+l*.25+I*.15+T*.25,R=g(s),H=C(q,R,a.rating,a.completedProjects),se=L(s,R,a),te=D(s),ae=v(s,a,{skillsMatch:r,locationMatch:I,competitionLevel:R,winProbability:H});return{missionId:s.id,title:s.title,description:s.description,budget:s.budget,matchScore:q,reasonsToApply:ae,competitionLevel:R,winProbability:H,recommendedBidPrice:se,skillsMatch:r,experienceMatch:l,locationMatch:I,urgency:te,clientProfile:{name:s.clientName,rating:4.2+Math.random()*.8,projectsPosted:Math.floor(Math.random()*20)+1,avgBudget:s.budget*(.8+Math.random()*.4)}}}).sort((s,r)=>r.matchScore-s.matchScore).slice(0,10);o(c),b(!1)},h=(t,c)=>{const s=P(t),r=c.skills.map(T=>T.toLowerCase());let l=0,I=s.length;return s.forEach(T=>{r.some(R=>R.includes(T)||T.includes(R)||A(T,R)>.7)&&l++}),Math.min(100,l/Math.max(I,1)*100)},k=(t,c)=>{let s=0;return c.completedProjects>=50?s+=40:c.completedProjects>=20?s+=30:c.completedProjects>=5?s+=20:s+=10,c.categories.includes(t.category)&&(s+=30),s+=c.rating/5*30,Math.min(100,s)},p=(t,c)=>{if(!t.location||!c.location)return 70;const s=t.location.toLowerCase(),r=c.location.toLowerCase();if(s===r)return 100;if(s.includes(r)||r.includes(s))return 85;const l=Math.random()*500;return l<50?90:l<100?75:l<200?60:40},x=(t,c)=>{const s=t.budget,r=c.hourlyRate,l=s/r;return l>=20&&l<=100?100:l>=10&&l<=150?80:l>=5&&l<=200?60:40},g=t=>{const c=t.bids?.length||0,s=Math.floor((Date.now()-new Date(t.createdAt).getTime())/(1e3*60*60*24));return c>10||s>7?"high":c>5||s>3?"medium":"low"},C=(t,c,s,r)=>{let l=t;return c==="low"?l*=1.3:c==="high"&&(l*=.7),l+=s/5*10,l+=Math.min(15,r*.2),Math.min(95,Math.max(5,l))},L=(t,c,s)=>{let l=t.budget;return c==="high"?l*=.85:c==="low"?l*=.95:l*=.9,s.rating>=4.5&&s.completedMissions>=20&&(l*=1.05),Math.round(l)},D=t=>{if(["urgent","asap","rapidement","immédiat","express"].some(l=>t.title.toLowerCase().includes(l)||t.description.toLowerCase().includes(l)))return"high";const r=Math.floor((Date.now()-new Date(t.createdAt).getTime())/(1e3*60*60*24));return r<=1?"high":r<=3?"medium":"low"},v=(t,c,s)=>{const r=[];return s.skillsMatch>=80&&r.push("Parfaite correspondance avec vos compétences"),s.competitionLevel==="low"&&r.push("Faible concurrence - grande chance de succès"),s.winProbability>=70&&r.push(`${Math.round(s.winProbability)}% de probabilité de gagner`),t.budget>=c.hourlyRate*20&&r.push("Budget attractif pour ce type de projet"),s.locationMatch>=90&&r.push("Client dans votre zone géographique"),r.slice(0,3)},P=t=>{const c=(t.title+" "+t.description+" "+t.category).toLowerCase(),s=["le","la","les","un","une","des","et","ou","mais","donc"];return c.split(/[\s,;.!?]+/).filter(r=>r.length>3&&!s.includes(r)).slice(0,10)},A=(t,c)=>{const s=t.length>c.length?t:c,r=t.length>c.length?c:t;if(s.length===0)return 1;const l=n(s,r);return(s.length-l)/s.length},n=(t,c)=>{const s=[];for(let r=0;r<=c.length;r++)s[r]=[r];for(let r=0;r<=t.length;r++)s[0][r]=r;for(let r=1;r<=c.length;r++)for(let l=1;l<=t.length;l++)c.charAt(r-1)===t.charAt(l-1)?s[r][l]=s[r-1][l-1]:s[r][l]=Math.min(s[r-1][l-1]+1,s[r][l-1]+1,s[r-1][l]+1);return s[c.length][t.length]},f=t=>{switch(t){case"low":return"text-green-600 bg-green-100";case"medium":return"text-yellow-600 bg-yellow-100";case"high":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},z=t=>{switch(t){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}};return M.useEffect(()=>{i.length>0&&S()},[i,a]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(F,{children:e.jsx(Q,{children:e.jsxs(ce,{className:"flex items-center space-x-2",children:[e.jsx(De,{className:"w-6 h-6 text-purple-600"}),e.jsx("span",{children:"Moteur de Matching IA"}),e.jsxs(B,{variant:"secondary",className:"bg-purple-100 text-purple-700",children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),"Algorithm v2.0"]})]})})}),j?e.jsx(F,{children:e.jsxs(W,{className:"py-12 text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-purple-600 border-t-transparent rounded-full mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-600",children:["Analyse de ",i.length," missions avec notre IA..."]})]})}):e.jsx("div",{className:"space-y-4",children:u.map((t,c)=>e.jsx(F,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(W,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:t.title}),e.jsxs(B,{className:`px-2 py-1 text-xs ${f(t.competitionLevel)}`,children:["Concurrence ",t.competitionLevel]}),e.jsx(B,{className:`px-2 py-1 text-xs ${z(t.urgency)}`,children:t.urgency==="high"?"Urgent":t.urgency==="medium"?"Normal":"Pas pressé"})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:t.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600 mb-1",children:[t.budget,"€"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Prix suggéré: ",t.recommendedBidPrice,"€"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Score de correspondance"}),e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:[Math.round(t.matchScore),"%"]})]}),e.jsx(ie,{value:t.matchScore,className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-xs text-gray-600",children:[e.jsxs("div",{children:["Compétences: ",Math.round(t.skillsMatch),"%"]}),e.jsxs("div",{children:["Expérience: ",Math.round(t.experienceMatch),"%"]}),e.jsxs("div",{children:["Localisation: ",Math.round(t.locationMatch),"%"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-sm font-medium mb-2 flex items-center",children:[e.jsx(de,{className:"w-4 h-4 mr-1 text-blue-600"}),"Pourquoi postuler"]}),e.jsx("ul",{className:"space-y-1",children:t.reasonsToApply.map((s,r)=>e.jsxs("li",{className:"text-sm text-gray-600 flex items-start",children:[e.jsx("span",{className:"text-green-500 mr-2",children:"•"}),s]},r))})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),t.clientProfile.name]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"w-4 h-4 mr-1 text-yellow-500"}),t.clientProfile.rating.toFixed(1)]}),e.jsxs("div",{children:[t.clientProfile.projectsPosted," projets postés"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"font-medium",children:[Math.round(t.winProbability),"% de succès"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Rang #",c+1," sur ",u.length]}),e.jsx($,{onClick:()=>m?.(t),className:"bg-purple-600 hover:bg-purple-700",children:"Voir la mission"})]})]})},t.missionId))})]})}function cs(){const{user:a}=me(),[,i]=ue(),[m,u]=M.useState(!1),[o,j]=M.useState(!1),[b,d]=M.useState(0),[N,S]=M.useState(0),[h,k]=M.useState({category:"all",budget:"all",location:"",sort:"newest"}),{data:p,isLoading:x,error:g,refetch:C}=re({queryKey:["/api/missions"],queryFn:async()=>{console.log("🔄 Début requête missions API avec mappers...");try{const n=await xe.getMissions();return console.log("✅ Missions normalisées récupérées:",n.missions.length),n}catch(n){return console.error("❌ Erreur réseau:",n),{missions:[],metadata:{total:0,has_errors:!0,error_message:`Erreur réseau: ${n instanceof Error?n.message:"Unknown error"}`,fallback_mode:!0}}}},refetchInterval:12e4,retry:(n,f)=>(console.log(`🔄 Tentative ${n+1}/3 après erreur:`,f),n<2),retryDelay:n=>{const f=Math.min(1e3*Math.pow(2,n),1e4);return console.log(`⏳ Retry dans ${f}ms`),f},staleTime:6e4,gcTime:3e5,refetchOnWindowFocus:!1,meta:{errorPolicy:"soft"}}),L=p?.missions||[],D=p?.metadata||{total:0},v=D.fallback_mode||!1;console.log("🏪 Marketplace - État actuel:",{missionsCount:L.length,isLoading:x,hasError:!!g,errorMessage:g?.message}),M.useEffect(()=>{if(g&&!x&&b<3&&Date.now()-N>5e3){const t=Math.min(2e3*Math.pow(2,b),1e4);console.log(`🔄 Retry automatique #${b+1} dans ${t}ms`);const c=setTimeout(()=>{console.log(`🔄 Exécution retry automatique #${b+1}`),d(s=>s+1),S(Date.now()),C()},t);return()=>clearTimeout(c)}},[g,x,b,N,C]),M.useEffect(()=>{!g&&!x&&L.length>0&&d(0)},[g,x,L.length]);const P=L.filter(n=>{if(h.category&&h.category!=="all"&&n.category!==h.category||h.location&&!n.location?.toLowerCase().includes(h.location.toLowerCase()))return!1;if(h.budget&&h.budget!=="all"){const f=n.budget;switch(h.budget){case"0-500":return f>=0&&f<=500;case"500-2000":return f>500&&f<=2e3;case"2000-5000":return f>2e3&&f<=5e3;case"5000+":return f>5e3;default:return!0}}return!0}).sort((n,f)=>{switch(h.sort){case"newest":return new Date(f.createdAt).getTime()-new Date(n.createdAt).getTime();case"budget-high":return f.budget-n.budget;case"budget-low":return n.budget-f.budget;case"bids":return f.bids.length-n.bids.length;default:return 0}}),A=(n,f)=>{k(z=>({...z,[n]:f}))};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-2 sm:mb-4",children:"Marketplace des Projets"}),e.jsx("p",{className:"text-base sm:text-lg text-gray-600 mb-4",children:"Découvrez et soumissionnez sur les projets disponibles"}),e.jsx($e,{isLoading:x,hasError:!!g&&!v,isFallbackMode:v,errorMessage:D?.error_message,onRetry:()=>{console.log("🔄 Retry depuis la bannière"),C()},className:"mb-4"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs($,{onClick:()=>j(!o),variant:"outline",className:"mb-4 gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z"})}),"Filtres",o?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),o&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Filtres de recherche"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"category-filter",className:"text-xs font-medium text-gray-600 mb-1 block",children:"Catégorie"}),e.jsxs(X,{value:h.category,onValueChange:n=>A("category",n),children:[e.jsx(U,{className:"h-8",children:e.jsx(O,{placeholder:"Toutes les catégories"})}),e.jsxs(K,{children:[e.jsx(w,{value:"all",children:"Toutes les catégories"}),J.map(n=>e.jsx(w,{value:n.id,children:n.name},n.id))]})]})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"budget-filter",className:"text-xs font-medium text-gray-600 mb-1 block",children:"Budget"}),e.jsxs(X,{value:h.budget,onValueChange:n=>A("budget",n),children:[e.jsx(U,{className:"h-8",children:e.jsx(O,{placeholder:"Tous les budgets"})}),e.jsxs(K,{children:[e.jsx(w,{value:"all",children:"Tous les budgets"}),e.jsx(w,{value:"0-500",children:"0 - 500€"}),e.jsx(w,{value:"500-2000",children:"500€ - 2 000€"}),e.jsx(w,{value:"2000-5000",children:"2 000€ - 5 000€"}),e.jsx(w,{value:"5000+",children:"5 000€+"})]})]})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"location-filter",className:"text-xs font-medium text-gray-600 mb-1 block",children:"Localisation"}),e.jsx(he,{id:"location-filter",type:"text",placeholder:"Ville, région...",value:h.location,onChange:n=>A("location",n.target.value),className:"h-8"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx($,{onClick:()=>k({category:"all",budget:"all",location:"",sort:"newest"}),variant:"outline",className:"h-8 w-full",size:"sm",children:"Réinitialiser"})})]})]})]}),e.jsxs("div",{className:"lg:w-3/4 w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 mb-4 sm:mb-0",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["Toutes les missions (",P.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),"Chargement..."]}),!x&&!g&&!v&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Service actif"]}),v&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Mode dégradé"]}),D?.total!==void 0&&e.jsxs("div",{className:"text-sm text-gray-500",children:[D.total," total",D.has_errors&&" (avec erreurs)"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-3 w-full sm:w-auto",children:[a?.type==="provider"&&e.jsx($,{onClick:()=>u(!m),className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 w-full sm:w-auto",children:"🤖 Matching IA"}),e.jsxs("div",{className:"flex items-center space-x-2 w-full sm:w-auto",children:[e.jsx("span",{className:"text-sm text-gray-500 whitespace-nowrap",children:"Trier par:"}),e.jsxs(X,{value:h.sort,onValueChange:n=>A("sort",n),children:[e.jsx(U,{className:"w-full sm:w-40",children:e.jsx(O,{})}),e.jsxs(K,{children:[e.jsx(w,{value:"newest",children:"Plus récent"}),e.jsx(w,{value:"budget-high",children:"Budget décroissant"}),e.jsx(w,{value:"budget-low",children:"Budget croissant"}),e.jsx(w,{value:"bids",children:"Nombre d'offres"})]})]})]})]})]}),m&&a?.type==="provider"&&e.jsx("div",{className:"mb-8",children:e.jsx(_e,{providerProfile:{id:a.id,skills:["React","Node.js","TypeScript","Python"],location:"Paris",rating:4.7,completedProjects:28,portfolio:[],hourlyRate:65,categories:["web-development","mobile-development"]},missions:P,onMissionRecommended:n=>{i(`/missions/${n.missionId}`),u(!1)}})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[x&&e.jsxs("div",{className:"text-center py-12 sm:col-span-2 lg:col-span-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Chargement des missions..."})]}),(g||v)&&!x&&e.jsx("div",{className:"text-center py-12 sm:col-span-2 lg:col-span-3",children:e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-red-50 border border-orange-200 rounded-2xl p-8 mx-auto max-w-2xl",children:[e.jsx("div",{className:"text-orange-500 mb-4",children:v?"⚠️":"❌"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:v?"Mode dégradé activé":"Problème de chargement"}),e.jsx("p",{className:"text-gray-700 text-base mb-4",children:v?"Les missions ne peuvent pas être chargées normalement. Le système fonctionne en mode dégradé.":"Impossible de charger les missions pour le moment."}),D.error_message&&e.jsxs("div",{className:"bg-white/70 rounded-lg p-4 mb-4 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Détail:"})," ",D.error_message]}),!1,e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center mt-6",children:[e.jsx("button",{onClick:()=>{console.log("🔄 Retry manuel déclenché"),C()},className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all duration-200 shadow-lg hover:shadow-xl font-medium",children:"🔄 Réessayer"}),e.jsx("button",{onClick:()=>{console.log("🏠 Retour accueil"),window.location.href="/"},className:"px-6 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-200 shadow-lg hover:shadow-xl font-medium",children:"🏠 Retour accueil"})]}),e.jsxs("div",{className:"mt-6 text-sm text-gray-600",children:[e.jsxs("p",{className:"mb-2",children:["💡 ",e.jsx("strong",{children:"Suggestions:"})]}),e.jsxs("ul",{className:"text-left space-y-1 max-w-md mx-auto",children:[e.jsx("li",{children:"• Vérifiez votre connexion internet"}),e.jsx("li",{children:"• Essayez de recharger dans quelques minutes"}),e.jsx("li",{children:"• Contactez le support si le problème persiste"})]})]})]})}),v&&!x&&L.length===0&&e.jsx("div",{className:"sm:col-span-2 lg:col-span-3",children:e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-6 mb-8",children:[e.jsx("h4",{className:"text-lg font-semibold text-blue-900 mb-3",children:"📡 Service temporairement indisponible"}),e.jsx("p",{className:"text-blue-800 mb-4",children:"Les missions ne peuvent pas être chargées pour le moment. Veuillez réessayer dans quelques instants."})]})}),!x&&!g&&P.map(n=>e.jsx(Fe,{mission:n,onClick:()=>i(`/missions/${n.id}`)},n.id)),!x&&!g&&P.length===0&&e.jsxs("div",{className:"text-center py-12 sm:col-span-2 lg:col-span-3",children:[e.jsx("div",{className:"text-gray-300 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L10 8.586 8.707 7.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("p",{className:"text-gray-500 text-lg",children:["Aucune mission trouvée (",L.length," missions totales)"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Essayez de modifier vos filtres"})]})]})]})]})}export{cs as default};
