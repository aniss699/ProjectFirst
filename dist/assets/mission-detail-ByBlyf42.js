import{r as b,j as e}from"./ui-BcXBiFQq.js";import{u as me}from"./useQuery-DqWhVJ4y.js";import{j as L,e as O,G as qe,H as _e,L as j,I as D,B as g,J as Me,g as J,f as ae,U as T,q as re,P as se,C as w,a as E,i as A,l as W,X as te,b as k,V as ie,Z as De,D as xe,m as ue,y as pe,n as he,W as Re,h as Te,d as Pe,Y as Ee,u as Ae,O as de,F as ze}from"./index-svXQAOEo.js";import{d as Be}from"./services-B9yTTPPJ.js";import{f as H,g as $e,a as Fe}from"./categories-KhEpuZy7.js";import{T as F}from"./textarea-BIdOTEtx.js";import{T as ge,a as je,b as B,c as $}from"./tabs-EUTm0pJh.js";import{S as K,a as Q,b as G,c as Z,d as q}from"./select-B6KKNoN7.js";import{B as S}from"./badge-CDJKuBek.js";import{S as Y}from"./star-vgIxn4sV.js";import{E as X}from"./euro-Cyi4d-8G.js";import{C as I}from"./calendar-B_XIo80a.js";import{S as Ie}from"./switch-BOvpJ0t5.js";import{S as Ve}from"./settings-CQKR5OQO.js";import{G as Le}from"./globe-C18eaP22.js";import{L as Oe}from"./lock-4dD_EdAS.js";import{S as ve}from"./smart-bid-analyzer-C7PvnqRi.js";import{A as be}from"./award-CtTW2aS5.js";import{M as V}from"./message-circle-CmFghLgg.js";import{A as Ue}from"./availability-calendar-B4ihpV9_.js";import{M as fe}from"./map-pin-C2FjDqF-.js";import{P as He}from"./phone-C4Pw5Jux.js";import{C as Ne}from"./clock-B6SlfMuZ.js";import{C as Ke}from"./circle-x-Cw3W7qFX.js";import{C as Qe}from"./circle-alert-C3etJxzj.js";import"./vendor-D3F3s8fL.js";import"./index-DIYLGAU4.js";import"./triangle-alert-C9cIz10P.js";import"./lightbulb-qgEYDWFk.js";import"./trending-up-BvibdByO.js";import"./calendar-BQt5zOWY.js";import"./en-US-oEpl4HuW.js";import"./chevron-left-CZ0aQ8xE.js";import"./trash-2-C_AVoNcv.js";import"./save-CVD6WChV.js";import"./fr-Qfl_UVRO.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=L("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=L("HandHeart",[["path",{d:"M11 14h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 16",key:"1ifwr1"}],["path",{d:"m7 20 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9",key:"17abbs"}],["path",{d:"m2 15 6 6",key:"10dquu"}],["path",{d:"M19.5 8.5c.7-.7 1.5-1.6 1.5-2.7A2.73 2.73 0 0 0 16 4a2.78 2.78 0 0 0-5 1.8c0 1.2.8 2 1.5 2.8L16 12Z",key:"1h3036"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=L("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=L("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=L("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]);function we({missionId:c,onSuccess:f}){const{user:x}=O(),[d,y]=b.useState({amount:"",timeline:"",proposal:""}),o=qe("/api/bids",{successMessage:"ðŸš€ Offre envoyÃ©e avec succÃ¨s !",errorContext:"Soumission d'offre",invalidateQueries:[["/api/missions",c],["/api/missions"],["/api/users",x?.id,"bids"]],onSuccess:()=>{y({amount:"",timeline:"",proposal:""}),f()}}),v=_e({onSubmit:async r=>{o.mutate(r)},validateBeforeSubmit:Me.validateBid}),t=r=>{if(r.preventDefault(),!x){v.handleError(new Error("Vous devez Ãªtre connectÃ© pour postuler"),"Authentification requise");return}v.handleSubmit({...d,missionId:c,providerId:x.id,providerName:x.name,amount:d.amount,rating:x.rating||"5.0"})},n=(r,p)=>{y(N=>({...N,[r]:p}))};return!x||x.type!=="provider"?null:e.jsx("div",{className:"bg-white rounded-lg p-1",children:e.jsxs("form",{onSubmit:t,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"amount",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ’°"}),e.jsx("span",{children:"Prix proposÃ© (â‚¬)"})]}),e.jsx(D,{id:"amount",type:"number",step:"0.01",min:"0",placeholder:"Ex: 2500",value:d.amount,onChange:r=>n("amount",r.target.value),className:"h-11 rounded-lg border-2 border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-100 transition-colors",required:!0,"data-testid":"input-bid-price"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"timeline",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"â±ï¸"}),e.jsx("span",{children:"DÃ©lai de livraison"})]}),e.jsx(D,{id:"timeline",type:"text",placeholder:"Ex: 4 semaines",value:d.timeline,onChange:r=>n("timeline",r.target.value),className:"h-11 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-colors",required:!0,"data-testid":"input-bid-timeline"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"proposal",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“"}),e.jsx("span",{children:"DÃ©crivez votre proposition"})]}),e.jsx(F,{id:"proposal",placeholder:"Expliquez votre approche, votre expÃ©rience pertinente et ce que vous allez concrÃ¨tement livrer pour cette mission...",value:d.proposal,onChange:r=>n("proposal",r.target.value),className:"min-h-[120px] rounded-lg border-2 border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-100 resize-none transition-colors",required:!0,"data-testid":"textarea-bid-proposal"})]}),e.jsx("div",{className:"pt-2",children:e.jsx(g,{type:"submit",className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-3 px-6 rounded-lg text-base shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02]",disabled:o.isPending||v.isSubmitting,"data-testid":"button-submit-bid",children:o.isPending||v.isSubmitting?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Envoi en cours..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸš€"}),e.jsx("span",{children:"Envoyer ma candidature"})]})})})]})})}function We({missionId:c,onSuccess:f}){const{user:x}=O(),{toast:d}=J(),y=ae(),[o,v]=b.useState(!1),[t,n]=b.useState({amount:"",timeline_days:"",message:""}),[r,p]=b.useState([{name:x?.name||"",role:"Chef d'Ã©quipe",experience:"5+ annÃ©es",isLead:!0,rating:4.5}]),N=()=>{const i={name:"",role:"",experience:"",isLead:!1,rating:4};p([...r,i])},C=(i,h,a)=>{const s=[...r];s[i]={...s[i],[h]:a},p(s)},_=i=>{if(i===0)return;const h=r.filter((a,s)=>s!==i);p(h)},M=async i=>{if(i.preventDefault(),!x){d({title:"Erreur",description:"Vous devez Ãªtre connectÃ© pour soumettre une offre",variant:"destructive"});return}if(!t.amount||!t.timeline_days||!t.message){d({title:"Erreur",description:"Veuillez remplir tous les champs obligatoires",variant:"destructive"});return}if(r.length<2){d({title:"Erreur",description:"Une Ã©quipe doit avoir au moins 2 membres",variant:"destructive"});return}if(r.filter(a=>!a.name||!a.role||!a.experience).length>0){d({title:"Erreur",description:"Veuillez complÃ©ter les informations de tous les membres de l'Ã©quipe",variant:"destructive"});return}v(!0);try{const a={members:r,total_budget:parseInt(t.amount),estimated_timeline:parseInt(t.timeline_days),description:t.message},m=await(await ie("POST","/api/bids",{mission_id:parseInt(c),amount:t.amount,timeline_days:parseInt(t.timeline_days),message:t.message,bid_type:"team",team_composition:a,team_lead_id:x.id})).json();d({title:"âœ… Candidature d'Ã©quipe soumise !",description:`Votre Ã©quipe de ${r.length} membres a Ã©tÃ© proposÃ©e avec succÃ¨s.`}),y.invalidateQueries({queryKey:["mission-detail",c]}),y.invalidateQueries({queryKey:["missions"]}),f()}catch(a){console.error("Erreur soumission candidature Ã©quipe:",a),d({title:"Erreur",description:a instanceof Error?a.message:"Impossible de soumettre la candidature",variant:"destructive"})}finally{v(!1)}};return!x||x.type!=="provider"?null:e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center justify-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Candidature d'Ã©quipe"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"PrÃ©sentez votre Ã©quipe prÃ©-constituÃ©e pour cette mission"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(j,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Composition de l'Ã©quipe"]}),e.jsxs(g,{type:"button",variant:"outline",size:"sm",onClick:N,"data-testid":"button-add-member",children:[e.jsx(se,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]}),e.jsx("div",{className:"space-y-3",children:r.map((i,h)=>e.jsxs(w,{className:`${i.isLead?"ring-2 ring-purple-200 bg-purple-50":"bg-gray-50"}`,children:[e.jsx(E,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm flex items-center gap-2",children:i.isLead?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 text-purple-600"}),"Chef d'Ã©quipe"]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4"}),"Membre ",h]})}),!i.isLead&&e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:()=>_(h),"data-testid":`button-remove-member-${h}`,children:e.jsx(te,{className:"w-4 h-4"})})]})}),e.jsxs(k,{className:"pt-0 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"Nom complet *"}),e.jsx(D,{placeholder:"Nom du membre",value:i.name,onChange:a=>C(h,"name",a.target.value),disabled:i.isLead,"data-testid":`input-member-name-${h}`})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"RÃ´le/SpÃ©cialitÃ© *"}),e.jsx(D,{placeholder:"Ex: DÃ©veloppeur Frontend",value:i.role,onChange:a=>C(h,"role",a.target.value),"data-testid":`input-member-role-${h}`})]})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"ExpÃ©rience *"}),e.jsxs(K,{value:i.experience,onValueChange:a=>C(h,"experience",a),children:[e.jsx(Q,{"data-testid":`select-member-experience-${h}`,children:e.jsx(G,{placeholder:"Niveau d'expÃ©rience"})}),e.jsxs(Z,{children:[e.jsx(q,{value:"1-2 annÃ©es",children:"1-2 annÃ©es"}),e.jsx(q,{value:"3-5 annÃ©es",children:"3-5 annÃ©es"}),e.jsx(q,{value:"5+ annÃ©es",children:"5+ annÃ©es"}),e.jsx(q,{value:"10+ annÃ©es",children:"10+ annÃ©es"})]})]})]})]})]},h))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(j,{htmlFor:"team-amount",className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Prix total Ã©quipe (â‚¬) *"]}),e.jsx(D,{id:"team-amount",type:"number",placeholder:"15000",min:"100",value:t.amount,onChange:i=>n(h=>({...h,amount:i.target.value})),"data-testid":"input-team-amount"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Montant global pour toute l'Ã©quipe"})]}),e.jsxs("div",{children:[e.jsxs(j,{htmlFor:"team-timeline",className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"DÃ©lai (jours) *"]}),e.jsx(D,{id:"team-timeline",type:"number",placeholder:"30",min:"1",value:t.timeline_days,onChange:i=>n(h=>({...h,timeline_days:i.target.value})),"data-testid":"input-team-timeline"})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"team-message",className:"text-base font-medium",children:"Proposition dÃ©taillÃ©e *"}),e.jsx(F,{id:"team-message",placeholder:"DÃ©crivez comment votre Ã©quipe va rÃ©aliser cette mission, la rÃ©partition des tÃ¢ches, votre mÃ©thodologie...",rows:5,value:t.message,onChange:i=>n(h=>({...h,message:i.target.value})),"data-testid":"textarea-team-message"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"DÃ©taillez la stratÃ©gie de votre Ã©quipe pour cette mission"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"RÃ©capitulatif de l'Ã©quipe"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Membres:"}),e.jsxs(S,{variant:"secondary",children:[r.length," personnes"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Budget total:"}),e.jsxs(S,{variant:"secondary",children:[t.amount||"0","â‚¬"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"DÃ©lai:"}),e.jsxs(S,{variant:"secondary",children:[t.timeline_days||"0"," jours"]})]})]})]}),e.jsx(g,{type:"submit",className:"w-full bg-purple-600 hover:bg-purple-700",disabled:o,"data-testid":"button-submit-team-bid",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Soumission en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Soumettre la candidature d'Ã©quipe"]})})]})}function Xe({missionId:c,onSuccess:f}){const{user:x}=O(),{toast:d}=J(),y=ae(),[o,v]=b.useState(!1),[t,n]=b.useState({name:"",description:"",estimated_budget:"",estimated_timeline_days:"",max_members:"5",visibility:"public",auto_accept:!0}),[r,p]=b.useState([{title:"",description:"",skills:[],min_experience:1,priority:"medium"}]),N=()=>{const a={title:"",description:"",skills:[],min_experience:1,priority:"medium"};p([...r,a])},C=(a,s,m)=>{const u=[...r];u[a]={...u[a],[s]:m},p(u)},_=a=>{if(r.length<=1)return;const s=r.filter((m,u)=>u!==a);p(s)},M=(a,s)=>{if(!s.trim())return;const m=[...r],u=m[a].skills;u.includes(s.trim())||(m[a].skills=[...u,s.trim()],p(m))},i=(a,s)=>{const m=[...r];m[a].skills=m[a].skills.filter((u,ee)=>ee!==s),p(m)},h=async a=>{if(a.preventDefault(),!x){d({title:"Erreur",description:"Vous devez Ãªtre connectÃ© pour crÃ©er une Ã©quipe ouverte",variant:"destructive"});return}if(!t.name||!t.description||!t.estimated_budget||!t.estimated_timeline_days){d({title:"Erreur",description:"Veuillez remplir tous les champs obligatoires",variant:"destructive"});return}const s=r.filter(m=>m.title.trim());if(s.length===0){d({title:"Erreur",description:"Veuillez dÃ©finir au moins un rÃ´le recherchÃ©",variant:"destructive"});return}v(!0);try{const u=await(await ie("POST","/api/open-teams",{mission_id:parseInt(c),name:t.name,description:t.description,estimated_budget:parseInt(t.estimated_budget)*100,estimated_timeline_days:parseInt(t.estimated_timeline_days),max_members:parseInt(t.max_members),visibility:t.visibility,auto_accept:t.auto_accept,required_roles:s,members:[{user_id:x.id,name:x.name,role:"Initiateur",experience_years:5,rating:4.5,joined_at:new Date().toISOString()}]})).json();d({title:"ðŸš€ Ã‰quipe ouverte crÃ©Ã©e !",description:`${t.name} est maintenant ouverte au recrutement.`}),y.invalidateQueries({queryKey:["mission-detail",c]}),y.invalidateQueries({queryKey:["open-teams"]}),f()}catch(m){console.error("Erreur crÃ©ation Ã©quipe ouverte:",m),d({title:"Erreur",description:m instanceof Error?m.message:"Impossible de crÃ©er l'Ã©quipe ouverte",variant:"destructive"})}finally{v(!1)}};return!x||x.type!=="provider"?null:e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center justify-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"CrÃ©er une Ã©quipe ouverte"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Initiez une Ã©quipe oÃ¹ d'autres prestataires peuvent vous rejoindre"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"team-name",className:"text-base font-medium",children:"Nom de l'Ã©quipe *"}),e.jsx(D,{id:"team-name",placeholder:"Ex: Ã‰quipe DÃ©veloppement Web Pro",value:t.name,onChange:a=>n(s=>({...s,name:a.target.value})),"data-testid":"input-team-name"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"team-description",className:"text-base font-medium",children:"Description de l'Ã©quipe *"}),e.jsx(F,{id:"team-description",placeholder:"DÃ©crivez votre approche, votre vision pour cette mission...",rows:3,value:t.description,onChange:a=>n(s=>({...s,description:a.target.value})),"data-testid":"textarea-team-description"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(j,{htmlFor:"estimated-budget",className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Budget estimÃ© (â‚¬) *"]}),e.jsx(D,{id:"estimated-budget",type:"number",placeholder:"10000",min:"100",value:t.estimated_budget,onChange:a=>n(s=>({...s,estimated_budget:a.target.value})),"data-testid":"input-estimated-budget"})]}),e.jsxs("div",{children:[e.jsxs(j,{htmlFor:"estimated-timeline",className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"DÃ©lai estimÃ© (jours) *"]}),e.jsx(D,{id:"estimated-timeline",type:"number",placeholder:"45",min:"1",value:t.estimated_timeline_days,onChange:a=>n(s=>({...s,estimated_timeline_days:a.target.value})),"data-testid":"input-estimated-timeline"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(j,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"RÃ´les recherchÃ©s"]}),e.jsxs(g,{type:"button",variant:"outline",size:"sm",onClick:N,"data-testid":"button-add-role",children:[e.jsx(se,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]}),e.jsx("div",{className:"space-y-3",children:r.map((a,s)=>e.jsxs(w,{className:"bg-orange-50 border-orange-200",children:[e.jsx(E,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(A,{className:"text-sm",children:["RÃ´le ",s+1]}),r.length>1&&e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:()=>_(s),"data-testid":`button-remove-role-${s}`,children:e.jsx(te,{className:"w-4 h-4"})})]})}),e.jsxs(k,{className:"pt-0 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"Titre du poste *"}),e.jsx(D,{placeholder:"Ex: DÃ©veloppeur React",value:a.title,onChange:m=>C(s,"title",m.target.value),"data-testid":`input-role-title-${s}`})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"PrioritÃ©"}),e.jsxs(K,{value:a.priority,onValueChange:m=>C(s,"priority",m),children:[e.jsx(Q,{"data-testid":`select-role-priority-${s}`,children:e.jsx(G,{})}),e.jsxs(Z,{children:[e.jsx(q,{value:"high",children:"Haute"}),e.jsx(q,{value:"medium",children:"Moyenne"}),e.jsx(q,{value:"low",children:"Basse"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"Description du rÃ´le"}),e.jsx(F,{placeholder:"DÃ©crivez les responsabilitÃ©s et attentes...",rows:2,value:a.description,onChange:m=>C(s,"description",m.target.value),"data-testid":`textarea-role-description-${s}`})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"CompÃ©tences requises"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:a.skills.map((m,u)=>e.jsxs(S,{variant:"secondary",className:"flex items-center gap-1",children:[m,e.jsx(te,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>i(s,u)})]},u))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{placeholder:"Ajouter une compÃ©tence...",onKeyPress:m=>{m.key==="Enter"&&(m.preventDefault(),M(s,m.currentTarget.value),m.currentTarget.value="")},"data-testid":`input-role-skill-${s}`}),e.jsx(g,{type:"button",variant:"outline",size:"sm",onClick:m=>{const u=m.currentTarget.parentNode?.querySelector("input");u&&(M(s,u.value),u.value="")},children:e.jsx(se,{className:"w-4 h-4"})})]})]})]})]},s))})]}),e.jsxs(w,{className:"bg-gray-50",children:[e.jsx(E,{children:e.jsxs(A,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),"ParamÃ¨tres de l'Ã©quipe"]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"Nombre max de membres"}),e.jsxs(K,{value:t.max_members,onValueChange:a=>n(s=>({...s,max_members:a})),children:[e.jsx(Q,{"data-testid":"select-max-members",children:e.jsx(G,{})}),e.jsxs(Z,{children:[e.jsx(q,{value:"3",children:"3 membres"}),e.jsx(q,{value:"5",children:"5 membres"}),e.jsx(q,{value:"7",children:"7 membres"}),e.jsx(q,{value:"10",children:"10 membres"})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"VisibilitÃ©"}),e.jsxs(K,{value:t.visibility,onValueChange:a=>n(s=>({...s,visibility:a})),children:[e.jsx(Q,{"data-testid":"select-visibility",children:e.jsx(G,{})}),e.jsxs(Z,{children:[e.jsx(q,{value:"public",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4"}),"Publique"]})}),e.jsx(q,{value:"private",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"PrivÃ©e"]})})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ie,{id:"auto-accept",checked:t.auto_accept,onCheckedChange:a=>n(s=>({...s,auto_accept:a})),"data-testid":"switch-auto-accept"}),e.jsx(j,{htmlFor:"auto-accept",className:"text-sm",children:"Accepter automatiquement les candidatures"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg p-4 border",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"RÃ©capitulatif de l'Ã©quipe ouverte"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Nom:"}),e.jsx(S,{variant:"secondary",children:t.name||"Non dÃ©fini"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Budget estimÃ©:"}),e.jsxs(S,{variant:"secondary",children:[t.estimated_budget||"0","â‚¬"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Membres max:"}),e.jsxs(S,{variant:"secondary",children:[t.max_members," personnes"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"RÃ´les dÃ©finis:"}),e.jsxs(S,{variant:"secondary",children:[r.filter(a=>a.title).length," rÃ´les"]})]})]})]}),e.jsx(g,{type:"submit",className:"w-full bg-orange-600 hover:bg-orange-700",disabled:o,"data-testid":"button-submit-open-team",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"CrÃ©ation en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"CrÃ©er l'Ã©quipe ouverte"]})})]})}function Je({mission:c,user:f,sortedBids:x,showAIAnalyzer:d,setShowAIAnalyzer:y,showBidForm:o,setShowBidForm:v}){const[t,n]=b.useState("individual"),[r,p]=b.useState(!1),[N,C]=b.useState(!1);return e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 md:p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center",children:e.jsx(be,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm md:text-base",children:"Candidater Ã  cette mission"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:"Choisissez votre mode de candidature"})]})]}),e.jsxs(ge,{value:t,onValueChange:_=>n(_),className:"w-full",children:[e.jsxs(je,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsxs(B,{value:"individual",className:"text-xs md:text-sm data-[testid=tab-individual]","data-testid":"tab-individual",children:[e.jsx(W,{className:"w-4 h-4 mr-1"}),"Solo"]}),e.jsxs(B,{value:"team",className:"text-xs md:text-sm","data-testid":"tab-team",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"Ã‰quipe"]}),e.jsxs(B,{value:"open_team",className:"text-xs md:text-sm","data-testid":"tab-open-team",children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),"Ã‰quipe Ouverte"]})]}),e.jsx($,{value:"individual",className:"space-y-4 mt-0",children:e.jsxs(w,{className:"bg-blue-50 border-blue-200",children:[e.jsx(E,{className:"pb-3",children:e.jsxs(A,{className:"text-sm flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Candidature individuelle"]})}),e.jsxs(k,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Candidatez seul Ã  cette mission avec votre expertise."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(g,{onClick:()=>y(!d),className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-sm",size:"default","data-testid":"button-ai-analyzer",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Analyser avec l'IA"]}),e.jsxs(g,{onClick:()=>v(!o),className:"w-full bg-green-600 hover:bg-green-700 text-sm",size:"default","data-testid":"button-submit-individual",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),o?"Masquer le formulaire":"Soumettre une offre"]})]}),d&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(ve,{missionTitle:c.title,missionDescription:c.description,missionBudget:parseFloat(c.budget||"0"),missionCategory:c.category,currentBid:{price:0,timeline:"",proposal:""},providerProfile:{rating:4.5,completedProjects:25,skills:["React","Node.js","TypeScript"],portfolio:[]},competitorBids:x,onOptimizedBidGenerated:_=>{v(!0)}})}),o&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(we,{missionId:c.id,onSuccess:()=>{v(!1),y(!1)}})})]})]})}),e.jsx($,{value:"team",className:"space-y-4 mt-0",children:e.jsxs(w,{className:"bg-purple-50 border-purple-200",children:[e.jsx(E,{className:"pb-3",children:e.jsxs(A,{className:"text-sm flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"Candidature d'Ã©quipe"]})}),e.jsxs(k,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Candidatez avec une Ã©quipe prÃ©-constituÃ©e que vous dirigez."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white rounded-lg border",children:[e.jsx(Y,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Vous Ãªtes le chef d'Ã©quipe"})]}),e.jsxs(g,{onClick:()=>p(!r),className:"w-full bg-purple-600 hover:bg-purple-700 text-sm",size:"default","data-testid":"button-submit-team",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),r?"Masquer le formulaire":"Candidater en Ã©quipe"]})]}),r&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(We,{missionId:c.id,onSuccess:()=>{p(!1)}})})]})]})}),e.jsx($,{value:"open_team",className:"space-y-4 mt-0",children:e.jsxs(w,{className:"bg-orange-50 border-orange-200",children:[e.jsx(E,{className:"pb-3",children:e.jsxs(A,{className:"text-sm flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Ã‰quipe ouverte"]})}),e.jsxs(k,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"CrÃ©ez une Ã©quipe ouverte oÃ¹ d'autres prestataires peuvent vous rejoindre."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(ye,{className:"w-3 h-3 text-orange-600"}),e.jsx("span",{children:"Recrutement ouvert"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(Ge,{className:"w-3 h-3 text-orange-600"}),e.jsx("span",{children:"Collaboration"})]})]}),e.jsxs(g,{onClick:()=>C(!N),className:"w-full bg-orange-600 hover:bg-orange-700 text-sm",size:"default","data-testid":"button-submit-open-team",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),N?"Masquer le formulaire":"CrÃ©er une Ã©quipe ouverte"]})]}),N&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Xe,{missionId:c.id,onSuccess:()=>{C(!1)}})})]})]})})]})]})}function Ye({providerId:c,providerName:f,isOpen:x,onClose:d}){const{toast:y}=J(),{data:o,isLoading:v}=me({queryKey:["/api/providers",c,"profile"],enabled:!!c&&x}),t=n=>Array.from({length:5},(r,p)=>e.jsx(Y,{className:`w-4 h-4 ${p<n?"text-yellow-400 fill-current":"text-gray-300"}`},p));return!x||!c?null:e.jsx(xe,{open:x,onOpenChange:d,children:e.jsxs(ue,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(pe,{children:e.jsx(he,{asChild:!0,children:e.jsx(Re,{children:"Profil du prestataire"})})}),e.jsx("div",{className:"p-6"}),v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):o?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-secondary/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:o.name}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"w-4 h-4 mr-1"}),o.location||"Localisation non spÃ©cifiÃ©e"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"Membre depuis ",H(o.joinedAt)]})]}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:o.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center justify-end mb-2",children:[e.jsx("div",{className:"flex items-center mr-2",children:t(Math.round(parseFloat(o.rating)))}),e.jsx("span",{className:"text-xl font-bold",children:o.rating})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[o.totalProjects," projets rÃ©alisÃ©s"]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.skills.map((n,r)=>e.jsx(S,{variant:"secondary",children:n},r))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs(g,{className:"bg-blue-500 hover:bg-blue-600 text-white",onClick:()=>{window.location.href=`/messages?contact=${c}&name=${encodeURIComponent(f)}`},children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Message"]}),e.jsxs(g,{variant:"outline",className:"border-green-500 text-green-600 hover:bg-green-50",onClick:()=>{y({title:"Contacter le prestataire",description:`Appelez ${f} pour discuter du projet`})},children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Appeler"]}),e.jsxs(g,{className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white",onClick:()=>{y({title:"RÃ©servation de crÃ©neau",description:`FonctionnalitÃ© de rÃ©servation avec ${f} en cours de dÃ©veloppement`})},children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"RÃ©server un crÃ©neau"]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(re,{className:"w-5 h-5 mr-2"}),"RÃ©alisations rÃ©centes"]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:o.portfolio.slice(0,4).map(n=>e.jsx(w,{children:e.jsxs(k,{className:"p-4",children:[n.images.length>0&&e.jsx("img",{src:n.images[0],alt:n.title,className:"w-full h-32 object-cover rounded-lg mb-3"}),e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:n.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:n.description}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(S,{variant:"outline",children:n.category}),e.jsx("span",{className:"text-xs text-gray-500",children:H(n.completedAt)})]})]})},n.id))}),o.portfolio.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucune rÃ©alisation disponible pour le moment"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Ne,{className:"w-5 h-5 mr-2"}),"DisponibilitÃ©s"]}),e.jsx(w,{children:e.jsx(k,{className:"p-4",children:e.jsx(Ue,{readOnly:!0,initialAvailability:o.availability||[]})})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(be,{className:"w-5 h-5 mr-2"}),"Avis clients (",o.evaluations.length,")"]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:o.evaluations.map(n=>e.jsx(w,{children:e.jsxs(k,{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-1",children:[t(n.rating),e.jsx("span",{className:"ml-2 font-medium",children:n.clientName})]}),e.jsx("span",{className:"text-xs text-gray-500",children:H(n.createdAt)})]})}),e.jsx("p",{className:"text-gray-700 mb-3",children:n.comment}),n.photos&&n.photos.length>0&&e.jsx("div",{className:"flex space-x-2",children:n.photos.slice(0,3).map((r,p)=>e.jsx("img",{src:r,alt:`Photo ${p+1}`,className:"w-16 h-16 object-cover rounded-lg"},p))})]})},n.id))}),o.evaluations.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucun avis client pour le moment"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(g,{onClick:d,children:"Fermer"})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Profil non trouvÃ©"})})]})})}function es({bidId:c,bidderName:f,isOpen:x,onClose:d}){const{user:y}=O(),{toast:o}=J(),v=ae(),[t,n]=b.useState(null),[r,p]=b.useState(""),N=Te({mutationFn:async i=>(await ie("POST","/api/bids/respond",i)).json(),onSuccess:()=>{v.invalidateQueries({queryKey:["/api/missions"]});const i=t==="accept"?"acceptÃ©e":t==="reject"?"dÃ©clinÃ©e":"en nÃ©gociation";o({title:"RÃ©ponse envoyÃ©e !",description:`Votre rÃ©ponse (${i}) a Ã©tÃ© envoyÃ©e au prestataire. Il recevra une notification.`}),setTimeout(()=>{alert(`Confirmation : Votre rÃ©ponse "${i}" a bien Ã©tÃ© envoyÃ©e Ã  ${f}. Un email de confirmation lui a Ã©tÃ© envoyÃ©.`)},500),d(),n(null),p("")},onError:i=>{o({title:"Erreur",description:i.message||"Une erreur est survenue",variant:"destructive"})}}),C=i=>{if(i.preventDefault(),!t){o({title:"Action requise",description:"Veuillez choisir une action",variant:"destructive"});return}if(t==="negotiate"&&!r.trim()){o({title:"Message requis",description:"Veuillez ajouter un message pour nÃ©gocier",variant:"destructive"});return}N.mutate({bidId:c,status:t,message:r.trim()||null,clientResponse:t})},_=i=>{switch(i){case"accept":return`Bonjour ${f},

Nous avons le plaisir de vous informer que votre offre a Ã©tÃ© retenue pour ce projet. Nous allons procÃ©der Ã  la mise en place du contrat.

Cordialement`;case"reject":return`Bonjour ${f},

Nous vous remercions pour votre offre. Malheureusement, nous avons dÃ©cidÃ© de retenir une autre proposition pour ce projet.

Cordialement`;case"negotiate":return`Bonjour ${f},

Votre offre nous intÃ©resse. Cependant, nous aimerions discuter de certains points :

- 
- 

ÃŠtes-vous ouvert Ã  la nÃ©gociation ?

Cordialement`}},M=i=>{n(i),p(_(i))};return e.jsx(xe,{open:x,onOpenChange:d,children:e.jsxs(ue,{className:"sm:max-w-2xl bg-white border shadow-lg",children:[e.jsx(pe,{children:e.jsxs(he,{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(V,{className:"w-6 h-6 text-blue-500"}),"RÃ©pondre Ã  l'offre de ",f]})}),e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Choisissez votre rÃ©ponse :"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>M("accept"),className:`p-4 rounded-xl border-2 transition-all ${t==="accept"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-green-300"}`,children:[e.jsx(Pe,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsx("div",{className:"font-semibold",children:"Accepter"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Retenir cette offre"})]}),e.jsxs("button",{type:"button",onClick:()=>M("negotiate"),className:`p-4 rounded-xl border-2 transition-all ${t==="negotiate"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-blue-300"}`,children:[e.jsx(V,{className:"w-8 h-8 mx-auto mb-2 text-blue-500"}),e.jsx("div",{className:"font-semibold",children:"NÃ©gocier"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Demander des ajustements"})]}),e.jsxs("button",{type:"button",onClick:()=>M("reject"),className:`p-4 rounded-xl border-2 transition-all ${t==="reject"?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-red-300"}`,children:[e.jsx(Ke,{className:"w-8 h-8 mx-auto mb-2 text-red-500"}),e.jsx("div",{className:"font-semibold",children:"DÃ©cliner"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Ne pas retenir"})]})]})]}),t&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"message",className:"text-sm font-semibold text-gray-800",children:["Message Ã  ",f]}),e.jsx(F,{id:"message",value:r,onChange:i=>p(i.target.value),placeholder:"Votre message...",className:"min-h-[120px]"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(g,{type:"button",variant:"outline",onClick:d,className:"flex-1",disabled:N.isPending,children:"Annuler"}),e.jsx(g,{type:"submit",className:"flex-1 bg-blue-500 hover:bg-blue-600",disabled:!t||N.isPending,children:N.isPending?"Envoi...":"Envoyer la rÃ©ponse"})]})]})]})})}function Bs(){console.log("ðŸ” MissionDetailPage - DÃ©marrage du composant");const{user:c}=O(),f=Ee(),[,x]=Ae(),d=f.id;console.log("ðŸ” MissionDetailPage - Params reÃ§us:",{missionId:d,user:c?.name});const[y,o]=b.useState("overview"),[v,t]=b.useState(null),[n,r]=b.useState(""),[p,N]=b.useState(null),[C,_]=b.useState(""),[M,i]=b.useState(!1),[h,a]=b.useState(!1),{data:s,isLoading:m,error:u}=me({queryKey:["mission-detail",d],queryFn:async()=>{if(console.log("ðŸ” Chargement mission avec mappers ID:",d),!d||d==="undefined"||d==="null")throw new Error("ID de mission invalide");try{const l=await Be.getMissionById(d);return console.log("âœ… Mission normalisÃ©e chargÃ©e:",l.title),l}catch(l){throw console.error("âŒ Erreur lors du chargement de la mission:",l),l}},enabled:!!d,retry:1,retryDelay:2e3,staleTime:3e4});b.useEffect(()=>{if(s){document.title=`${s.title} - SwipDEAL`;const l=document.querySelector('meta[name="description"]');l&&l.setAttribute("content",`Mission: ${s.title} - Budget: ${s.budgetDisplay} - ${s.description.slice(0,150)}...`)}},[s]);const ee=()=>{if(!s||!c)return"overview";const R=[...s.bids||[]].sort((U,Se)=>U.amount-Se.amount),ce=s.teamRequirements&&s.teamRequirements.length>0;return c.type==="client"&&s.clientName===c.name&&R.length>0?"bids":ce&&c.type==="provider"&&s.clientName!==c.name?"team":"overview"};b.useEffect(()=>{if(console.log("ðŸ”„ useEffect - Mission ou user changÃ©:",{missionId:s?.id,userId:c?.id,missionExists:!!s}),s){const l=ee();console.log("ðŸ“Š Onglet par dÃ©faut calculÃ©:",l),o(l),t(null),r(""),N(null),_(""),i(!1),a(!1)}},[s?.id,c?.id,s,c]);const ke=l=>{o(l),console.log(`ðŸ“Š Navigation vers l'onglet: ${l} pour mission ${s?.id}`)},Ce=l=>{const R=parseFloat(l);return Array.from({length:5},(ce,U)=>e.jsx(Y,{className:`w-4 h-4 ${U<Math.floor(R)?"text-yellow-400 fill-current":"text-gray-300 dark:text-gray-600"}`},U))};if(console.log("ðŸ” MissionDetailPage - Ã‰tat du rendu:",{isLoading:m,hasError:!!u,hasMission:!!s,missionId:s?.id}),m)return console.log("â³ MissionDetailPage - Affichage du loading"),e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx("div",{className:"flex items-center justify-center min-h-[300px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Chargement de la mission"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"RÃ©cupÃ©ration des dÃ©tails..."})]})]})})})});if(u||!s)return console.error("âŒ MissionDetailPage - Erreur ou mission manquante:",{error:u instanceof Error?u.message:u,mission:s,missionId:d,hasError:!!u,hasMission:!!s,stack:u instanceof Error?u.stack:void 0}),e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"text-center mt-20",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-6 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:e.jsx(Qe,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-3",children:"Mission introuvable"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:u instanceof Error?u.message:"Cette mission n'existe plus ou a Ã©tÃ© supprimÃ©e."}),!1,e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(g,{onClick:()=>window.location.reload(),variant:"outline",children:"Recharger"}),e.jsxs(g,{onClick:()=>x("/marketplace"),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Retour au marketplace"]})]})]})})});console.log("âœ… MissionDetailPage - Mission chargÃ©e, prÃ©paration du rendu:",s.title);const le=s?$e(s.category):null,P=s?.bids?[...s.bids].sort((l,R)=>l.amount-R.amount):[],ne=s?.teamRequirements&&s.teamRequirements.length>0;return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(g,{onClick:()=>x("/marketplace"),variant:"ghost",className:"flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-800","data-testid":"button-back-marketplace",children:[e.jsx(de,{className:"w-4 h-4"}),"Retour au marketplace"]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4"}),P.length," candidature",P.length!==1?"s":""]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-4 h-4"}),s.createdAt?H(s.createdAt):"Date non spÃ©cifiÃ©e"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-3","data-testid":"text-mission-title",children:s.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1","data-testid":"text-client-name",children:[e.jsx(W,{className:"w-4 h-4"}),s.clientName]}),e.jsxs("span",{className:"flex items-center gap-1","data-testid":"text-budget",children:[e.jsx(X,{className:"w-4 h-4"}),s.budgetDisplay]}),le&&e.jsx(S,{variant:"secondary",className:"text-xs","data-testid":"badge-category",children:le.name})]})]})]})}),e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs(ge,{value:y,onValueChange:ke,className:"w-full",children:[e.jsxs(je,{className:"w-full bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-1 mb-6",children:[e.jsxs(B,{value:"overview",className:"flex-1 flex items-center gap-2 data-[state=active]:bg-blue-50 data-[state=active]:text-blue-600 dark:data-[state=active]:bg-blue-900/30 dark:data-[state=active]:text-blue-400","data-testid":"tab-overview",children:[e.jsx(ze,{className:"w-4 h-4"}),"DÃ©tails"]}),e.jsxs(B,{value:"bids",className:"flex-1 flex items-center gap-2 data-[state=active]:bg-blue-50 data-[state=active]:text-blue-600 dark:data-[state=active]:bg-blue-900/30 dark:data-[state=active]:text-blue-400","data-testid":"tab-bids",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Offres",e.jsx(S,{variant:"secondary",className:"text-xs ml-1",children:P.length})]}),ne&&e.jsxs(B,{value:"team",className:"flex-1 flex items-center gap-2 data-[state=active]:bg-blue-50 data-[state=active]:text-blue-600 dark:data-[state=active]:bg-blue-900/30 dark:data-[state=active]:text-blue-400","data-testid":"tab-team",children:[e.jsx(z,{className:"w-4 h-4"}),"Ã‰quipe",e.jsx(S,{variant:"secondary",className:"text-xs ml-1",children:s.teamRequirements?.length||0})]})]}),e.jsxs($,{value:"overview",className:"space-y-6","data-testid":"content-overview",children:[e.jsxs(w,{children:[e.jsx(E,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-blue-600"}),"Description du projet"]})}),e.jsx(k,{children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed","data-testid":"text-description",children:s.description})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(w,{children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx(X,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Budget"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400","data-testid":"text-budget-amount",children:s.budgetDisplay})]})]})})}),e.jsx(w,{children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(fe,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Localisation"}),e.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white","data-testid":"text-location",children:s.location||"Non spÃ©cifiÃ©"})]})]})})}),e.jsx(w,{children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Candidatures"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400","data-testid":"text-bids-count",children:P.length})]})]})})})]}),c&&c.type==="provider"&&s.clientName!==c.name&&e.jsx(Je,{mission:s,user:c,sortedBids:P,showAIAnalyzer:h,setShowAIAnalyzer:a,showBidForm:M,setShowBidForm:i}),c&&c.type==="provider"&&s.clientName===c.name&&e.jsx(w,{className:"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(oe,{className:"w-4 h-4 text-white"})}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300 font-medium",children:"Ceci est votre mission"})]})})})]}),e.jsx($,{value:"bids",className:"space-y-6","data-testid":"content-bids",children:P.length===0?e.jsx(w,{children:e.jsxs(k,{className:"p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(T,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-3",children:"Aucune candidature"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Cette mission n'a pas encore reÃ§u d'offres de prestataires"})]})}):e.jsx("div",{className:"space-y-6",children:P.map((l,R)=>e.jsx(w,{className:"hover:shadow-md transition-all duration-200","data-testid":`card-bid-${l.id}`,children:e.jsxs(k,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center text-white font-bold text-lg",children:l.providerName.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors",onClick:()=>{t(l.providerId),r(l.providerName)},"data-testid":`text-provider-${l.id}`,children:l.providerName}),R===0&&P.length>1&&e.jsx(S,{className:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",children:"Meilleure offre"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center",children:Ce("5.0")}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"5.0/5"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400 mb-1","data-testid":`text-bid-amount-${l.id}`,children:l.price||Fe(l.amount.toString())}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(Ne,{className:"w-4 h-4"}),l.timeline_days?`${l.timeline_days} jours`:"Non spÃ©cifiÃ©"]})]})]}),l.message&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed","data-testid":`text-bid-message-${l.id}`,children:l.message})}),c&&s.clientName===c.name&&e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(g,{onClick:()=>{N(l.id),_(l.providerName)},variant:"outline",className:"flex items-center gap-2","data-testid":`button-contact-${l.id}`,children:[e.jsx(V,{className:"w-4 h-4"}),"Contacter"]}),e.jsxs(g,{className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2","data-testid":`button-accept-${l.id}`,children:[e.jsx(oe,{className:"w-4 h-4"}),"Accepter l'offre"]})]})]})},l.id))})}),ne&&e.jsx($,{value:"team",className:"space-y-6","data-testid":"content-team",children:e.jsxs(w,{children:[e.jsx(E,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-purple-600"}),"Exigences d'Ã©quipe"]})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-4",children:s.teamRequirements?.map((l,R)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:l.profession}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-3",children:l.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-green-600 dark:text-green-400 font-medium",children:[l.estimated_budget,"â‚¬"]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[l.min_experience," ans d'expÃ©rience"]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[l.estimated_days," jours"]})]})]},R))})})]})})]})}),e.jsx(Ye,{providerId:v,providerName:n,isOpen:!!v,onClose:()=>{t(null),r("")}}),e.jsx(es,{bidId:p,bidderName:C,isOpen:!!p,onClose:()=>{N(null),_("")}}),M&&d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(we,{missionId:d,onSuccess:()=>{i(!1),window.location.reload()}})})}),h&&s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Analyse IA de la mission"}),e.jsx(g,{onClick:()=>a(!1),variant:"ghost",size:"sm",children:"âœ•"})]}),e.jsx(ve,{missionTitle:s.title,missionDescription:s.description,missionBudget:s.budget_value_cents||0,missionCategory:s.category,currentBid:{price:0,timeline:"Ã€ dÃ©finir",proposal:""},providerProfile:{rating:5,completedProjects:0,expertise:[]},onRecommendationApplied:()=>{a(!1),i(!0)}})]})})})]})}export{Bs as default};
